!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b=function(a,b){var c,d=a.match(/<%=\s?[$_\w]+\s?%>/g);return d&&(c=d.map(function(a){return a.replace(/^<%=\s?([$_\w]+)\s?%>$/,function(a,b){return b})}),d.map(function(d,e){var f=b[c[e]];f&&(a=a.replace(d,f))})),a},c=function(b,c){var d=[];return a.each(b,function(a,b){c(b)&&d.push(b)}),d},d=function(){var d,e,f,g={title:"锚点选择",confirm_text:"确定",cancel_text:"取消",rows:10},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="list-group" style="max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav><button type="button" class="btn btn-default" data-dismiss="modal"><%= cancel_text %></button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>',list:'<a href="javascript:void(0);" class="list-group-item" data-id="<%= id %>"><%= name %></a>'},k=function(b,c,d){a.ajax({url:b.url,method:b.method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},l=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);f=a.data,p(a)})},500)}},m=function(c){h.$list_group.html(""),a.each(c,function(c,d){var e=a(b(j.list,d));h.$list_group.append(e),e.bind("click",function(){a(this).addClass("active").siblings().removeClass("active")})})},n=function(c){var d,e=c.page,f=c.rows,g=Math.ceil(c.total/f),k=Math.max(e-3,1),m=Math.min(e+3,g),n=a(b(j.prev,{page:Math.max(e-1,1)})),o=a(b(j.next,{page:Math.min(e+1,g)}));if(h.$pagination.html(""),0!==g){for(c.page===k&&n.addClass("disabled"),h.$pagination.append(n),i=k;i<=m;i++)d=a(b(j.page,{page:i})),i===e&&d.addClass("active"),h.$pagination.append(d);c.page===m&&o.addClass("disabled"),h.$pagination.append(o),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||l(c)()})}},o=function(){var a=h.$list_group.find(".active");a.length&&(a=c(f,function(b){return b.id==a.data("id")}),d.onComplete(a.shift()))},p=function(a){m(a.data),n(a),h.$search.get(0).focus()};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$dialog.append(j.content),h.$content=h.$dialog.find(".modal-content"),h.$content.append(b(j.header,d)),h.$header=h.$dialog.find(".modal-header"),h.$content.append(b(j.body,d)),h.$body=h.$content.find(".modal-body"),h.$search=h.$body.find("input[type=search]"),h.$list_group=h.$body.find(".list-group"),h.$content.append(b(j.footer,d)),h.$footer=h.$content.find(".modal-footer"),h.$pagination=h.$footer.find(".pagination"),h.$confirm_btn=h.$footer.find(".btn-primary"),this},render:function(){h.$search.bind("keyup",l()).trigger("keyup"),d.onComplete&&h.$confirm_btn.unbind("click",o).bind("click",o)}}}(),e=function(){var d,e,f,g={title:"图片选择",confirm_text:"确定",cancel_text:"取消",rows:10},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content pk-folder"></div><div class="modal-content pk-image hidden"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',folder_body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="thumbnail-group" style="width: 100%; max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',folder:'<div class="thumbnail" style="display: inline-block; margin: 0 17px 10px 17px; padding: 0 26px; cursor: pointer; text-align: center;" data-id="<%= id %>"><span class="glyphicon glyphicon-folder-close" style="font-size: 120px;"></span><div class="caption"><h4><%= name %></h4><p>共有图片<b><%= total %></b>张</p></div></div>',folder_footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav></div>',image_body:'<div class="modal-body"><div><div class="thumbnail-group" style="width: 100%; max-height: 420px; overflow: auto; margin-bottom: 0;"></div></div></div>',image:'<a href="javascript:void(0);" class="thumbnail" style="display: inline-block; width: 182px; margin: 0 17px 10px 17px; padding: 0 10px; cursor: pointer;" data-id="<%= id %>"><img src="<%= src %>" alt="<%= name %>" style="max-width: 160px; max-height: 200px;"><div class="caption"><p><%= name %></p></div></a>',image_footer:'<div class="modal-footer"><button type="button" class="btn btn-default pk-back">返回</button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>'},k=function(b,c,d){a.ajax({url:b.folder_url,method:b.folder_method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},l=function(b,c,d){a.ajax({url:b.image_url,method:b.image_method||"get",data:{folder_id:c.folder_id},dataType:"json",success:d,error:function(a){throw a}})},m=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$folder_search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);p(a)})},500)}},n=function(c){h.$folder_group.html(""),a.each(c,function(c,d){var e=a(b(j.folder,d));h.$folder_group.append(e),e.bind("click",function(){var b=a(this).data("id");r(b)})})},o=function(c){var d,e=c.page,f=c.rows,g=Math.ceil(c.total/f),k=Math.max(e-3,1),l=Math.min(e+3,g),n=a(b(j.prev,{page:Math.max(e-1,1)})),o=a(b(j.next,{page:Math.min(e+1,g)}));if(h.$pagination.html(""),0!==g){for(c.page===k&&n.addClass("disabled"),h.$pagination.append(n),i=k;i<=l;i++)d=a(b(j.page,{page:i})),i===e&&d.addClass("active"),h.$pagination.append(d);c.page===l&&o.addClass("disabled"),h.$pagination.append(o),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||m(c)()})}},p=function(a){n(a.data),o(a),h.$folder_search.get(0).focus()},q=function(c){a.each(c,function(c,d){var e=a(b(j.image,d));h.$image_group.append(e),e.bind("click",function(){var b=a(this);b.addClass("active"),b.siblings().removeClass("active")})})},r=function(a){h.$image_group.html(""),h.$folder_content.addClass("hidden"),h.$image_content.removeClass("hidden"),l(d,{folder_id:a},function(a){if(a.code)throw Error(a.message);f=a.data,q(f)})},s=function(){var a=h.$image_group.find(".active");a.length&&(a=c(f,function(b){return b.id==a.data("id")}),d.onComplete(a.shift()))};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$content=a(b(j.content,d)),h.$dialog.append(h.$content),h.$folder_content=h.$content.find(".pk-folder"),h.$folder_header=a(b(j.header,d)),h.$folder_body=a(b(j.folder_body,d)),h.$folder_footer=a(b(j.folder_footer,d)),h.$folder_search=h.$folder_body.find("input[type=search]"),h.$folder_group=h.$folder_body.find(".thumbnail-group"),h.$pagination=h.$folder_footer.find(".pagination"),h.$folder_content.append(h.$folder_header),h.$folder_content.append(h.$folder_body),h.$folder_content.append(h.$folder_footer),h.$image_content=h.$content.find(".pk-image"),h.$image_header=a(b(j.header,d)),h.$image_body=a(b(j.image_body,d)),h.$image_footer=a(b(j.image_footer,d)),h.$image_group=h.$image_body.find(".thumbnail-group"),h.$back_btn=h.$image_footer.find(".pk-back"),h.$confirm_btn=h.$image_footer.find(".btn-primary"),h.$image_content.append(h.$image_header),h.$image_content.append(h.$image_body),h.$image_content.append(h.$image_footer),this},render:function(){h.$folder_search.bind("keyup",m()).trigger("keyup"),h.$back_btn.bind("click",function(){h.$folder_content.removeClass("hidden"),h.$image_content.addClass("hidden"),h.$folder_search.get(0).focus()}),d.onComplete&&h.$confirm_btn.unbind("click",s).bind("click",s)}}}(),f=function(){var d,e,f,g={title:"图片选择",confirm_text:"确定",cancel_text:"取消",rows:10},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content pk-folder"></div><div class="modal-content pk-image hidden"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',folder_body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="thumbnail-group" style="width: 100%; max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',folder:'<div class="thumbnail" style="display: inline-block; margin: 0 17px 10px 17px; padding: 0 26px; cursor: pointer; text-align: center;" data-id="<%= id %>"><span class="glyphicon glyphicon-folder-close" style="font-size: 120px;"></span><div class="caption"><h4><%= name %></h4><p>共有图片<b><%= total %></b>张</p></div></div>',folder_footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav></div>',image_body:'<div class="modal-body"><div><div class="thumbnail-group" style="width: 100%; max-height: 420px; overflow: auto; margin-bottom: 0;"></div></div></div>',image:'<a href="javascript:void(0);" class="thumbnail" style="display: inline-block; width: 182px; margin: 0 17px 10px 17px; padding: 0 10px; cursor: pointer;" data-id="<%= id %>"><img src="<%= src %>" alt="<%= name %>" style="max-width: 160px; max-height: 200px;"><div class="caption"><input type="checkbox"> <span><%= name %></span></div></a>',image_footer:'<div class="modal-footer"><button type="button" class="btn btn-default pk-back">返回</button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>'},k=function(b,c,d){a.ajax({url:b.folder_url,method:b.folder_method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},l=function(b,c,d){a.ajax({url:b.image_url,method:b.image_method||"get",data:{folder_id:c.folder_id},dataType:"json",success:d,error:function(a){throw a}})},m=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$folder_search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);p(a)})},500)}},n=function(c){h.$folder_group.html(""),a.each(c,function(c,d){var e=a(b(j.folder,d));h.$folder_group.append(e),e.bind("click",function(){var b=a(this).data("id");r(b)})})},o=function(c){var d,e=c.page,f=c.rows,g=Math.ceil(c.total/f),k=Math.max(e-3,1),l=Math.min(e+3,g),n=a(b(j.prev,{page:Math.max(e-1,1)})),o=a(b(j.next,{page:Math.min(e+1,g)}));if(h.$pagination.html(""),0!==g){for(c.page===k&&n.addClass("disabled"),h.$pagination.append(n),i=k;i<=l;i++)d=a(b(j.page,{page:i})),i===e&&d.addClass("active"),h.$pagination.append(d);c.page===l&&o.addClass("disabled"),h.$pagination.append(o),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||m(c)()})}},p=function(a){n(a.data),o(a),h.$folder_search.get(0).focus()},q=function(c){a.each(c,function(c,d){var e=a(b(j.image,d));h.$image_group.append(e)})},r=function(a){h.$image_group.html(""),h.$folder_content.addClass("hidden"),h.$image_content.removeClass("hidden"),l(d,{folder_id:a},function(a){if(a.code)throw Error(a.message);f=a.data,q(f)})},s=function(){var b=h.$image_group.find("input[type=checkbox]:checked"),e=a.map(b,function(b,c){return a(b).parents("[data-id]").data("id")});b.length&&(b=c(f,function(a){return~e.indexOf(a.id)}),d.onComplete(b))};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$content=a(b(j.content,d)),h.$dialog.append(h.$content),h.$folder_content=h.$content.find(".pk-folder"),h.$folder_header=a(b(j.header,d)),h.$folder_body=a(b(j.folder_body,d)),h.$folder_footer=a(b(j.folder_footer,d)),h.$folder_search=h.$folder_body.find("input[type=search]"),h.$folder_group=h.$folder_body.find(".thumbnail-group"),h.$pagination=h.$folder_footer.find(".pagination"),h.$folder_content.append(h.$folder_header),h.$folder_content.append(h.$folder_body),h.$folder_content.append(h.$folder_footer),h.$image_content=h.$content.find(".pk-image"),h.$image_header=a(b(j.header,d)),h.$image_body=a(b(j.image_body,d)),h.$image_footer=a(b(j.image_footer,d)),h.$image_group=h.$image_body.find(".thumbnail-group"),h.$back_btn=h.$image_footer.find(".pk-back"),h.$confirm_btn=h.$image_footer.find(".btn-primary"),h.$image_content.append(h.$image_header),h.$image_content.append(h.$image_body),h.$image_content.append(h.$image_footer),this},render:function(){h.$folder_search.bind("keyup",m()).trigger("keyup"),h.$back_btn.bind("click",function(){h.$folder_content.removeClass("hidden"),h.$image_content.addClass("hidden"),h.$folder_search.get(0).focus()}),d.onComplete&&h.$confirm_btn.unbind("click",s).bind("click",s)}}}(),g={single_text:d,single_picture:e,multi_picture:f};return a.fn.picker=function(b,c){var d=g[b];if(!d)throw Error("Picker is undefined.");return d.init(a(this),c).build().render(),this}});