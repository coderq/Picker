!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b=function(a,b){var c,d=a.match(/<%=\s?[$_\w]+\s?%>/g);return d&&(c=d.map(function(a){return a.replace(/^<%=\s?([$_\w]+)\s?%>$/,function(a,b){return b})}),d.map(function(d,e){var f=b[c[e]];a=a.replace(d,f||"")})),a},c=function(b,c){var d=[];return a.each(b,function(a,b){c(b)&&d.push(b)}),d},d=function(){var d,e,f,g={title:"锚点选择",confirm_text:"确定",cancel_text:"取消",rows:10},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="list-group" style="max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav><button type="button" class="btn btn-default" data-dismiss="modal"><%= cancel_text %></button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>',list:'<a href="javascript:void(0);" class="list-group-item" data-id="<%= id %>"><%= name %></a>'},k=function(b,c,d){a.ajax({url:b.url,method:b.method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},l=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);f=a.data,p(a)})},500)}},m=function(c){h.$list_group.html(""),a.each(c,function(c,d){var e=a(b(j.list,d));h.$list_group.append(e),e.bind("click",function(){a(this).addClass("active").siblings().removeClass("active")})})},n=function(c){var d,e=c.page,f=c.rows,g=Math.ceil(c.total/f),k=Math.max(e-3,1),m=Math.min(e+3,g),n=a(b(j.prev,{page:Math.max(e-1,1)})),o=a(b(j.next,{page:Math.min(e+1,g)}));if(h.$pagination.html(""),0!==g){for(c.page===k&&n.addClass("disabled"),h.$pagination.append(n),i=k;i<=m;i++)d=a(b(j.page,{page:i})),i===e&&d.addClass("active"),h.$pagination.append(d);c.page===m&&o.addClass("disabled"),h.$pagination.append(o),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||l(c)()})}},o=function(){var a=h.$list_group.find(".active");a.length&&(a=c(f,function(b){return b.id==a.data("id")}),d.onComplete(a.shift()))},p=function(a){m(a.data),n(a),h.$search.get(0).focus()};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$dialog.append(j.content),h.$content=h.$dialog.find(".modal-content"),h.$content.append(b(j.header,d)),h.$header=h.$dialog.find(".modal-header"),h.$content.append(b(j.body,d)),h.$body=h.$content.find(".modal-body"),h.$search=h.$body.find("input[type=search]"),h.$list_group=h.$body.find(".list-group"),h.$content.append(b(j.footer,d)),h.$footer=h.$content.find(".modal-footer"),h.$pagination=h.$footer.find(".pagination"),h.$confirm_btn=h.$footer.find(".btn-primary"),this},render:function(){h.$search.bind("keyup",l()).trigger("keyup"),d.onComplete&&h.$confirm_btn.unbind("click",o).bind("click",o)}}}(),e=function(){var d,e,f,g={title:"图片选择",confirm_text:"确定",cancel_text:"取消",rows:10},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content pk-folder"></div><div class="modal-content pk-image hidden"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',folder_body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="thumbnail-group" style="width: 100%; max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',folder:'<div class="thumbnail" style="display: inline-block; margin: 0 17px 10px 17px; padding: 0 26px; cursor: pointer; text-align: center;" data-id="<%= id %>"><span class="glyphicon glyphicon-folder-close" style="font-size: 120px;"></span><div class="caption"><h4><%= name %></h4><p>共有图片<b><%= total %></b>张</p></div></div>',folder_footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav></div>',image_body:'<div class="modal-body"><div><div class="thumbnail-group" style="width: 100%; max-height: 420px; overflow: auto; margin-bottom: 0;"></div></div></div>',image:'<a href="javascript:void(0);" class="thumbnail" style="display: inline-block; width: 182px; margin: 0 17px 10px 17px; padding: 0 10px; cursor: pointer;" data-id="<%= id %>"><img src="<%= src %>" alt="<%= name %>" style="max-width: 160px; max-height: 200px;"><div class="caption"><p><%= name %></p></div></a>',image_footer:'<div class="modal-footer"><button type="button" class="btn btn-default pk-back">返回</button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>'},k=function(b,c,d){a.ajax({url:b.folder_url,method:b.folder_method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},l=function(b,c,d){a.ajax({url:b.image_url,method:b.image_method||"get",data:{folder_id:c.folder_id},dataType:"json",success:d,error:function(a){throw a}})},m=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$folder_search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);p(a)})},500)}},n=function(c){h.$folder_group.html(""),a.each(c,function(c,d){var e=a(b(j.folder,d));h.$folder_group.append(e),e.bind("click",function(){var b=a(this).data("id");r(b)})})},o=function(c){var d,e=c.page,f=c.rows,g=Math.ceil(c.total/f),k=Math.max(e-3,1),l=Math.min(e+3,g),n=a(b(j.prev,{page:Math.max(e-1,1)})),o=a(b(j.next,{page:Math.min(e+1,g)}));if(h.$pagination.html(""),0!==g){for(c.page===k&&n.addClass("disabled"),h.$pagination.append(n),i=k;i<=l;i++)d=a(b(j.page,{page:i})),i===e&&d.addClass("active"),h.$pagination.append(d);c.page===l&&o.addClass("disabled"),h.$pagination.append(o),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||m(c)()})}},p=function(a){n(a.data),o(a),h.$folder_search.get(0).focus()},q=function(c){a.each(c,function(c,d){var e=a(b(j.image,d));h.$image_group.append(e),e.bind("click",function(){var b=a(this);b.addClass("active"),b.siblings().removeClass("active")})})},r=function(a){h.$image_group.html(""),h.$folder_content.addClass("hidden"),h.$image_content.removeClass("hidden"),l(d,{folder_id:a},function(a){if(a.code)throw Error(a.message);f=a.data,q(f)})},s=function(){var a=h.$image_group.find(".active");a.length&&(a=c(f,function(b){return b.id==a.data("id")}),d.onComplete(a.shift()))};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$content=a(b(j.content,d)),h.$dialog.append(h.$content),h.$folder_content=h.$content.find(".pk-folder"),h.$folder_header=a(b(j.header,d)),h.$folder_body=a(b(j.folder_body,d)),h.$folder_footer=a(b(j.folder_footer,d)),h.$folder_search=h.$folder_body.find("input[type=search]"),h.$folder_group=h.$folder_body.find(".thumbnail-group"),h.$pagination=h.$folder_footer.find(".pagination"),h.$folder_content.append(h.$folder_header),h.$folder_content.append(h.$folder_body),h.$folder_content.append(h.$folder_footer),h.$image_content=h.$content.find(".pk-image"),h.$image_header=a(b(j.header,d)),h.$image_body=a(b(j.image_body,d)),h.$image_footer=a(b(j.image_footer,d)),h.$image_group=h.$image_body.find(".thumbnail-group"),h.$back_btn=h.$image_footer.find(".pk-back"),h.$confirm_btn=h.$image_footer.find(".btn-primary"),h.$image_content.append(h.$image_header),h.$image_content.append(h.$image_body),h.$image_content.append(h.$image_footer),this},render:function(){h.$folder_search.bind("keyup",m()).trigger("keyup"),h.$back_btn.bind("click",function(){h.$folder_content.removeClass("hidden"),h.$image_content.addClass("hidden"),h.$folder_search.get(0).focus()}),d.onComplete&&h.$confirm_btn.unbind("click",s).bind("click",s)}}}(),f=function(){var d,e,f,g={title:"图片选择",confirm_text:"确定",cancel_text:"取消",rows:10},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content pk-folder"></div><div class="modal-content pk-image hidden"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',folder_body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="thumbnail-group" style="width: 100%; max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',folder:'<div class="thumbnail" style="display: inline-block; margin: 0 17px 10px 17px; padding: 0 26px; cursor: pointer; text-align: center;" data-id="<%= id %>"><span class="glyphicon glyphicon-folder-close" style="font-size: 120px;"></span><div class="caption"><h4><%= name %></h4><p>共有图片<b><%= total %></b>张</p></div></div>',folder_footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav></div>',image_body:'<div class="modal-body"><div><div class="thumbnail-group" style="width: 100%; max-height: 420px; overflow: auto; margin-bottom: 0;"></div></div></div>',image:'<a href="javascript:void(0);" class="thumbnail" style="display: inline-block; width: 182px; margin: 0 17px 10px 17px; padding: 0 10px; cursor: pointer;" data-id="<%= id %>"><img src="<%= src %>" alt="<%= name %>" style="max-width: 160px; max-height: 200px;"><div class="caption"><input type="checkbox"> <span><%= name %></span></div></a>',image_footer:'<div class="modal-footer"><button type="button" class="btn btn-default pk-back">返回</button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>'},k=function(b,c,d){a.ajax({url:b.folder_url,method:b.folder_method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},l=function(b,c,d){a.ajax({url:b.image_url,method:b.image_method||"get",data:{folder_id:c.folder_id},dataType:"json",success:d,error:function(a){throw a}})},m=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$folder_search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);p(a)})},500)}},n=function(c){h.$folder_group.html(""),a.each(c,function(c,d){var e=a(b(j.folder,d));h.$folder_group.append(e),e.bind("click",function(){var b=a(this).data("id");r(b)})})},o=function(c){var d,e=c.page,f=c.rows,g=Math.ceil(c.total/f),k=Math.max(e-3,1),l=Math.min(e+3,g),n=a(b(j.prev,{page:Math.max(e-1,1)})),o=a(b(j.next,{page:Math.min(e+1,g)}));if(h.$pagination.html(""),0!==g){for(c.page===k&&n.addClass("disabled"),h.$pagination.append(n),i=k;i<=l;i++)d=a(b(j.page,{page:i})),i===e&&d.addClass("active"),h.$pagination.append(d);c.page===l&&o.addClass("disabled"),h.$pagination.append(o),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||m(c)()})}},p=function(a){n(a.data),o(a),h.$folder_search.get(0).focus()},q=function(c){a.each(c,function(c,d){var e=a(b(j.image,d));h.$image_group.append(e)})},r=function(a){h.$image_group.html(""),h.$folder_content.addClass("hidden"),h.$image_content.removeClass("hidden"),l(d,{folder_id:a},function(a){if(a.code)throw Error(a.message);f=a.data,q(f)})},s=function(){var b=h.$image_group.find("input[type=checkbox]:checked"),e=a.map(b,function(b,c){return a(b).parents("[data-id]").data("id")});b.length&&(b=c(f,function(a){return~e.indexOf(a.id)}),d.onComplete(b))};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$content=a(b(j.content,d)),h.$dialog.append(h.$content),h.$folder_content=h.$content.find(".pk-folder"),h.$folder_header=a(b(j.header,d)),h.$folder_body=a(b(j.folder_body,d)),h.$folder_footer=a(b(j.folder_footer,d)),h.$folder_search=h.$folder_body.find("input[type=search]"),h.$folder_group=h.$folder_body.find(".thumbnail-group"),h.$pagination=h.$folder_footer.find(".pagination"),h.$folder_content.append(h.$folder_header),h.$folder_content.append(h.$folder_body),h.$folder_content.append(h.$folder_footer),h.$image_content=h.$content.find(".pk-image"),h.$image_header=a(b(j.header,d)),h.$image_body=a(b(j.image_body,d)),h.$image_footer=a(b(j.image_footer,d)),h.$image_group=h.$image_body.find(".thumbnail-group"),h.$back_btn=h.$image_footer.find(".pk-back"),h.$confirm_btn=h.$image_footer.find(".btn-primary"),h.$image_content.append(h.$image_header),h.$image_content.append(h.$image_body),h.$image_content.append(h.$image_footer),this},render:function(){h.$folder_search.bind("keyup",m()).trigger("keyup"),h.$back_btn.bind("click",function(){h.$folder_content.removeClass("hidden"),h.$image_content.addClass("hidden"),h.$folder_search.get(0).focus()}),d.onComplete&&h.$confirm_btn.unbind("click",s).bind("click",s)}}}(),g=function(){var d,e,f,g={title:"商品选择",confirm_text:"确定",cancel_text:"取消",rows:8},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content pk-brand"></div><div class="modal-content pk-goods hidden"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',brand_body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="thumbnail-group" style="width: 100%; max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',brand:'<div class="thumbnail" style="display: inline-block; margin: 0 17px 10px 17px; padding: 0 26px; cursor: pointer; text-align: center;" data-id="<%= id %>"><img src="<%= img %>" style="width: 128px;" /><div class="caption"><h4><%= name %></h4><p>共有商品<b><%= total %></b>件</p></div></div>',brand_footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav></div>',goods_body:'<div class="modal-body"><div><form class="form-inline pk-goods-type-group" style="line-height: 32px;"></form><div class="thumbnail-group" style="width: 100%; max-height: 420px; overflow: auto; margin-bottom: 0;"></div></div></div>',goods_type:'<label style="margin-right:10px;"><input type="radio" name="goods_type" value="<%= id %>">&nbsp;<%= name %></label>',goods:'<a href="javascript:void(0);" class="thumbnail" style="display: inline-block; width: 182px; margin: 0 17px 10px 17px; padding: 0 10px; cursor: pointer;" data-id="<%= id %>"><img src="<%= src %>" alt="<%= name %>" style="max-width: 160px; max-height: 200px;"><div class="caption"><p><%= name %></p></div></a>',goods_footer:'<div class="modal-footer"><button type="button" class="btn btn-default pk-back">返回</button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>'},k=function(b,c,d){a.ajax({url:b.brand_url,method:b.brand_method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},l=function(b,c,d){a.ajax({url:b.goods_type_url,method:b.goods_method||"get",data:{brand_id:c.brand_id},dataType:"json",success:d,error:function(a){throw a}})},m=function(b,c,d){a.ajax({url:b.goods_url,method:b.goods_method||"get",data:{brand_id:c.brand_id,goods_type_id:c.goods_type_id},dataType:"json",success:d,error:function(a){throw a}})},n=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$brand_search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);q(a)})},500)}},o=function(c){h.$brand_group.html(""),a.each(c,function(c,d){var e=a(b(j.brand,d));h.$brand_group.append(e),e.bind("click",function(){var b=a(this).data("id");t(b)})})},p=function(c){var d,e=c.page,f=c.rows,g=Math.ceil(c.total/f),k=Math.max(e-3,1),l=Math.min(e+3,g),m=a(b(j.prev,{page:Math.max(e-1,1)})),o=a(b(j.next,{page:Math.min(e+1,g)}));if(h.$pagination.html(""),0!==g){for(c.page===k&&m.addClass("disabled"),h.$pagination.append(m),i=k;i<=l;i++)d=a(b(j.page,{page:i})),i===e&&d.addClass("active"),h.$pagination.append(d);c.page===l&&o.addClass("disabled"),h.$pagination.append(o),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||n(c)()})}},q=function(a){o(a.data),p(a),h.$brand_search.get(0).focus()},r=function(c,d){c.unshift({id:"0",name:"全部",checked:"true"}),a.each(c,function(c,e){var f;f=a(b(j.goods_type,e)),h.$goods_type_group.append(f),c||f.find("input").attr("checked",!0),f.find("input").bind("change",function(){var b=a(this),c=b.siblings();b.is(":checked")&&(c.attr("checked",!1),t(d,b.val()))})})},s=function(c){a.each(c,function(c,d){var e=a(b(j.goods,d));h.$goods_group.append(e),e.bind("click",function(){var b=a(this);b.addClass("active"),b.siblings().removeClass("active")})})},t=function(a,b){h.$goods_group.html(""),h.$brand_content.addClass("hidden"),h.$goods_content.removeClass("hidden"),b||l(d,{brand_id:a},function(b){if(b.code)throw Error(b.message);f=b.data,r(f,a)}),m(d,{brand_id:a,goods_type_id:b},function(a){if(a.code)throw Error(a.message);f=a.data,s(f)})},u=function(){var a=h.$goods_group.find(".active");a.length&&(a=c(f,function(b){return b.id==a.data("id")}),d.onComplete(a.shift()))};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$content=a(b(j.content,d)),h.$dialog.append(h.$content),h.$brand_content=h.$content.find(".pk-brand"),h.$brand_header=a(b(j.header,d)),h.$brand_body=a(b(j.brand_body,d)),h.$brand_footer=a(b(j.brand_footer,d)),h.$brand_search=h.$brand_body.find("input[type=search]"),h.$brand_group=h.$brand_body.find(".thumbnail-group"),h.$pagination=h.$brand_footer.find(".pagination"),h.$brand_content.append(h.$brand_header),h.$brand_content.append(h.$brand_body),h.$brand_content.append(h.$brand_footer),h.$goods_content=h.$content.find(".pk-goods"),h.$goods_header=a(b(j.header,d)),h.$goods_body=a(b(j.goods_body,d)),h.$goods_footer=a(b(j.goods_footer,d)),h.$goods_type_group=h.$goods_body.find(".pk-goods-type-group"),h.$goods_group=h.$goods_body.find(".thumbnail-group"),h.$back_btn=h.$goods_footer.find(".pk-back"),h.$confirm_btn=h.$goods_footer.find(".btn-primary"),h.$goods_content.append(h.$goods_header),h.$goods_content.append(h.$goods_body),h.$goods_content.append(h.$goods_footer),this},render:function(){h.$brand_search.bind("keyup",n()).trigger("keyup"),h.$back_btn.bind("click",function(){h.$brand_content.removeClass("hidden"),h.$goods_content.addClass("hidden"),h.$brand_search.get(0).focus()}),d.onComplete&&h.$confirm_btn.unbind("click",u).bind("click",u)}}}(),h=function(){var c,d,e={title:"商品选择",confirm_text:"确定",cancel_text:"取消",rows:8},f=[],g={},h={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content pk-brand"></div><div class="modal-content pk-goods hidden"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',brand_body:'<div class="modal-body"><div><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="thumbnail-group" style="width: 100%; max-height: 320px; overflow: auto; margin-bottom: 0;"></div></div></div>',brand:'<div class="thumbnail" style="display: inline-block; margin: 0 17px 10px 17px; padding: 0 26px; cursor: pointer; text-align: center;" data-id="<%= id %>"><img src="<%= img %>" style="width: 128px;" /><div class="caption"><h4><%= name %></h4><p>共有商品<b><%= total %></b>件</p></div></div>',brand_footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav></div>',goods_body:'<div class="modal-body"><div><form class="form-inline pk-goods-type-group"></form><div class="row"><div class="col-md-9 thumbnail-group pk-goods-group"></div><div class="col-md-3 thumbnail-group pk-goods-selected-group">选择并双击左侧商品</div></div></div>',goods_type:'<label style="margin-right:10px;"><input type="radio" name="goods_type" value="<%= id %>">&nbsp;<%= name %></label>',goods:'<div class="thumbnail" data-id="<%= id %>"><img src="<%= src %>" alt="<%= name %>" /><div class="caption"><p class="pk-left"><%= name %></p><p class="pk-right"><a href="#" role="button" class="btn btn-danger btn-xs pk-remove-btn hidden"><span class="glyphicon glyphicon-trash"></span></a></p></div></div>',goods_footer:'<div class="modal-footer"><button type="button" class="btn btn-default pk-back">返回</button><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>'},j=function(b,c,d){a.ajax({url:b.brand_url,method:b.brand_method||"get",data:{search:c.text,page:c.page,rows:c.rows},dataType:"json",success:d,error:function(a){throw a}})},k=function(b,c,d){a.ajax({url:b.goods_type_url,method:b.goods_method||"get",data:{brand_id:c.brand_id},dataType:"json",success:d,error:function(a){throw a}})},l=function(b,c,d){a.ajax({url:b.goods_url,method:b.goods_method||"get",data:{brand_id:c.brand_id,goods_type_id:c.goods_type_id},dataType:"json",success:d,error:function(a){throw a}})},m=function(a){return function(){d&&clearTimeout(d),d=setTimeout(function(){var b=g.$brand_search.val(),d=c.rows;j(c,{text:b,page:a||1,rows:d},function(a){if(a.code)throw Error(a.message);p(a)})},500)}},n=function(c){g.$brand_group.html(""),a.each(c,function(c,d){var e=a(b(h.brand,d));g.$brand_group.append(e),e.bind("click",function(){var b=a(this).data("id");g.$goods_type_group.html(""),g.$goods_group.html(""),g.$goods_selected_group.html(""),f=[],s(b)})})},o=function(c){var d,e=c.page,f=c.rows,j=Math.ceil(c.total/f),k=Math.max(e-3,1),l=Math.min(e+3,j),n=a(b(h.prev,{page:Math.max(e-1,1)})),o=a(b(h.next,{page:Math.min(e+1,j)}));if(g.$pagination.html(""),0!==j){for(c.page===k&&n.addClass("disabled"),g.$pagination.append(n),i=k;i<=l;i++)d=a(b(h.page,{page:i})),i===e&&d.addClass("active"),g.$pagination.append(d);c.page===l&&o.addClass("disabled"),g.$pagination.append(o),g.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||m(c)()})}},p=function(a){n(a.data),o(a),g.$brand_search.get(0).focus()},q=function(c,d){c.unshift({id:"0",name:"全部",checked:"true"}),a.each(c,function(c,e){var f;f=a(b(h.goods_type,e)),g.$goods_type_group.append(f),c||f.find("input").attr("checked",!0),f.find("input").bind("change",function(){var b=a(this),c=b.siblings();b.is(":checked")&&(c.attr("checked",!1),s(d,b.val()))})})},r=function(c){a.each(c,function(c,d){var e=a(b(h.goods,d));g.$goods_group.append(e),e.bind("dblclick",function(){var b=a(this),c=g.$goods_selected_group,e=c.find("[data-id="+b.data("id")+"]"),h=b.clone();c.find("div").length||c.html(""),e.length||(f.push(d),c.append(h),h.find(".pk-remove-btn").removeClass("hidden").bind("click",function(){for(var a=h.data("id"),b=0;b<f.length;b++)f[b].id==a&&(f.splice(b,1),b--);h.remove()}))})})},s=function(a,b){g.$goods_group.html(""),g.$brand_content.addClass("hidden"),g.$goods_content.removeClass("hidden"),b||k(c,{brand_id:a},function(b){if(b.code)throw Error(b.message);q(b.data,a)}),l(c,{brand_id:a,goods_type_id:b},function(a){if(a.code)throw Error(a.message);r(a.data)})},t=function(){f.length&&c.onComplete(f)};return{init:function(b,d){return g.$dialog=b,c=a.extend(e,d),this},build:function(){return g.$dialog.html(""),g.$content=a(b(h.content,c)),g.$dialog.append(g.$content),g.$brand_content=g.$content.find(".pk-brand"),g.$brand_header=a(b(h.header,c)),g.$brand_body=a(b(h.brand_body,c)),g.$brand_footer=a(b(h.brand_footer,c)),g.$brand_search=g.$brand_body.find("input[type=search]"),g.$brand_group=g.$brand_body.find(".thumbnail-group"),g.$pagination=g.$brand_footer.find(".pagination"),g.$brand_content.append(g.$brand_header),g.$brand_content.append(g.$brand_body),g.$brand_content.append(g.$brand_footer),g.$goods_content=g.$content.find(".pk-goods"),g.$goods_header=a(b(h.header,c)),g.$goods_body=a(b(h.goods_body,c)),g.$goods_footer=a(b(h.goods_footer,c)),g.$goods_type_group=g.$goods_body.find(".pk-goods-type-group"),g.$goods_group=g.$goods_body.find(".pk-goods-group"),g.$goods_selected_group=g.$goods_body.find(".pk-goods-selected-group"),g.$back_btn=g.$goods_footer.find(".pk-back"),g.$confirm_btn=g.$goods_footer.find(".btn-primary"),g.$goods_content.append(g.$goods_header),g.$goods_content.append(g.$goods_body),g.$goods_content.append(g.$goods_footer),this},render:function(){g.$brand_search.bind("keyup",m()).trigger("keyup"),g.$back_btn.bind("click",function(){g.$brand_content.removeClass("hidden"),g.$goods_content.addClass("hidden"),g.$brand_search.get(0).focus()}),c.onComplete&&g.$confirm_btn.unbind("click",t).bind("click",t)}}}(),j={single_text:d,single_picture:e,multi_picture:f,single_goods:g,multi_goods:h};return a.fn.picker=function(b,c){var d=j[b];if(!d)throw Error("Picker is undefined.");return d.init(a(this),c).build().render(),this}});