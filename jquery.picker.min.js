!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b=function(a,b){var c,d=a.match(/<%=\s?[$_\w]+\s?%>/g);return d&&(c=d.map(function(a){return a.replace(/^<%=\s?([$_\w]+)\s?%>$/,function(a,b){return b})}),d.map(function(d,e){var f=b[c[e]];a=a.replace(d,f||"")})),a},c=function(b,c){var d=[];return a.each(b,function(a,b){c(b)&&d.push(b)}),d},d=function(){var d,e,f,g={title:"图片选择",confirm_text:"确定",cancel_text:"取消",rows:10},h={},j={content:'<div class="modal-dialog modal-lg" role="document"><div class="modal-content"></div></div>',header:'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><%= title %></h4></div>',body:'<div class="modal-body"><input class="form-control" type="search" placeholder="Search..." style="margin-bottom: 10px;"><div class="thumbnail-group" style="width: 100%; max-height: 470px; overflow: auto; margin-bottom: 0;"></div></div>',image:'<a href="javascript:void(0);" class="thumbnail" style="display: inline-block; width: 182px; margin: 0 17px 10px 17px; padding: 0 10px; cursor: pointer;" data-id="<%= id %>"><img src="<%= src %>" alt="<%= name %>" style="max-width: 160px; max-height: 200px;"><div class="caption"><p><%= name %></p></div></a>',footer:'<div class="modal-footer"><nav style="float: left;"><ul class="pagination" style="margin: 0;"></ul></nav><button type="button" class="btn btn-primary"><%= confirm_text %></button></div>',prev:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',next:'<li data-page="<%= page %>"><a href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>',page:'<li data-page="<%= page %>"><a href="javascript:void(0);"><%= page %></a></li>'},k=function(b,c,d){a.ajax({url:b.url,method:b.method||"get",data:c,dataType:"json",success:d,error:function(a){throw a}})},l=function(a){return function(){e&&clearTimeout(e),e=setTimeout(function(){var b=h.$search.val(),c=d.rows;k(d,{text:b,page:a||1,rows:c},function(a){if(a.code)throw Error(a.message);f=a.data,o(a.data,a.page,a.rows,a.total)})},500)}},m=function(c){h.$group.html(""),a.each(c,function(c,d){var e=a(b(j.image,d));h.$group.append(e),e.bind("click",function(){var b=a(this);b.addClass("active"),b.siblings().removeClass("active")})})},n=function(c,d,e){var f,g,k,m,n;if(e=Math.ceil(e/d),m=Math.max(c-3,1),n=Math.min(c+3,e),f=a(b(j.prev,{page:Math.max(c-1,1)})),g=a(b(j.next,{page:Math.min(c+1,e)})),h.$pagination.html(""),console.log(m,n,e),0!==e){for(c===m&&f.addClass("disabled"),h.$pagination.append(f),i=m;i<=n;i++)k=a(b(j.page,{page:i})),i===c&&k.addClass("active"),h.$pagination.append(k);c===n&&g.addClass("disabled"),h.$pagination.append(g),h.$pagination.find("li").bind("click",function(){var b=a(this),c=b.data("page");b.hasClass("active")||l(c)()})}},o=function(a,b,c,d){m(a),n(b,c,d),h.$search.get(0).focus()},p=function(){var a=h.$body.find(".active");a.length&&(a=c(f,function(b){return b.id==a.data("id")}),d.onComplete(a.shift()))};return{init:function(b,c){return h.$dialog=b,d=a.extend(g,c),this},build:function(){return h.$dialog.html(""),h.$content=a(b(j.content,d)),h.$dialog.append(h.$content),h.$content=h.$content.find(".modal-content"),h.$header=h.$content.append(b(j.header,d)),h.$body=h.$content.append(b(j.body,d)),h.$footer=h.$content.append(b(j.footer,d)),h.$search=h.$body.find("input[type=search]"),h.$group=h.$body.find(".thumbnail-group"),h.$pagination=h.$footer.find(".pagination"),h.$confirm_btn=h.$footer.find(".btn-primary"),this},render:function(){console.log(h.$search),h.$search.bind("keyup",l()).trigger("keyup"),d.onComplete&&h.$confirm_btn.unbind("click",p).bind("click",p)}}}(),e={single_picture:d};return a.fn.picker=function(b,c){var d=e[b];if(!d)throw Error("Picker is undefined.");return d.init(a(this),c).build().render(),this}});